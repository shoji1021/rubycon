<!DOCTYPE html>
<html lang="ja">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" href="/pager.png" />
 <title>RubyTech</title>
 <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.basic.min.js"></script>
 <link rel="stylesheet" href="https://unpkg.com/blockly/media/blockly.min.css">
 <style>
  body {
   margin: 0;
   background: linear-gradient(135deg, #FA7B7B, #FA7B7B);
   font-family: 'Noto Sans JP', 'Roboto', sans-serif;
   color: #333;
   text-align: center;
  }
  /* bodyスクロール禁止 (モーダル表示時) */
  body.modal-open {
    overflow: hidden;
  }

  a {
   text-decoration: none;
   color: inherit;
  }

  /* ロゴ部分 */
  .RubyTech{
   font-family: 'Nunito', sans-serif;
   font-size: 1.6em;
   display: flex;
   align-items: center;
  }
  .R {
   width: auto;
   height: 40px;
   padding-left: 0;
   margin-left: 0;
  }

 /* ナビバー */
 .topbar {
  background: linear-gradient(90deg, #470d1c, #40121e);
  color: white;
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-weight: bold;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1000;
 }

 .topbar a {
  color: white;
  margin-left: 16px;
  font-size: 0.95em;
  transition: opacity 0.2s;
 }

 .topbar a:hover {
  opacity: 0.8;
 }

 .nav-links {
  margin-right: 50px;
 }

 h1 {
  font-size: 2em;
  text-align: center;
  color: #470d1c; /* 深紅 */
  margin: 100px auto 60px;
  display: inline-block;
  background: #fff; /* 白背景 */
  padding: 20px 60px;
  border: 3px solid #470d1c;
  border-radius: 16px; /* 角を少し丸く */
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); /* 軽い立体感 */
  letter-spacing: 1px;
  transition: all 0.3s ease;
  text-align: center;
 }

 /* レベル一覧コンテナ (Gridを維持) */
 .levels {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 35px;
  width: 70vw; /* ウィンドウ幅の70% */
  margin: 0 auto 150px;
  padding: 0 20px;
  text-align: left;
  box-sizing: border-box;
  }

 /* ▼▼▼ CSS修正箇所 ▼▼▼ */

 /* レベルカードのベース */
 .level-box {
  background-color: white;
  border: 2px solid #e1e1e1;
  border-radius: 14px;
  padding: 20px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  height: auto;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
 }

 /* カードのHoverエフェクト (★Hover詳細は削除し、隆起エフェクトのみ残す) */
 .level-box:hover {
  box-shadow: 0 6px 16px rgba(0,0,0,0.15);
  transform: translateY(-4px);
  border-color: #af3f3f;
 }

 /* Level 1, 2 などのタイトル部分 */
 .level-title {
  font-weight: 700;
  color: #470d1c;
  font-size: 1.2em;
  margin-bottom: 15px;
 }

 /* 進捗バーとボタンのコンテナ (画像UI) */
 .level-summary {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: auto;
  padding-top: 10px;
  padding-bottom: 10px;
  border-top: 1px solid #f0f0f0;
 }

 .progress-area {
  flex-grow: 1;
  margin-right: 20px;
 }

 .progress-container {
  width: 100%;
  background-color: #f0f0f0;
  border-radius: 4px;
  height: 10px;
  overflow: hidden;
 }

 .progress-bar {
  height: 100%;
  background-color: #a04040;
  transition: width 0.5s ease;
 }

 .progress-text {
  font-size: 0.9em;
  color: #555;
  display: block;
  margin-top: 4px;
 }

 /* アクションエリア (ボタンとリンク) */
 .action-area {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex-shrink: 0;
 }

 /* 「学習する」ボタン */
 .btn-study {
  background-color: #f0ad4e;
  color: #333;
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  text-decoration: none;
  font-weight: bold;
  font-size: 1em;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: background-color 0.2s ease;
 }
 .btn-study:hover {
  background-color: #ec9a29;
 }

 /* 「レッスンを見る」リンク */
 .view-details-link {
  font-size: 0.9em;
  color: #777;
  text-decoration: none;
  margin-top: 8px;
  cursor: pointer; /* クリック可能を示す */
 }
 .view-details-link:hover {
  text-decoration: underline; /* ホバーで下線 */
 }

 /* ★修正：詳細エリアは非表示にしておく (JSで内容を取得するため) */
 .level-details {
  display: none;
 }

 /* モーダル背景 (オーバーレイ) */
 .modal-overlay {
  display: none; /* ★JSで 'flex' に変更して表示 */
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6); /* 半透明の黒 */
  justify-content: center;
  align-items: center;
  z-index: 2000; /* ナビバーより上 */
  opacity: 0;
  transition: opacity 0.3s ease;
 }

 /* モーダル本体 (コンテンツボックス) */
 .modal-content {
  background-color: white;
  padding: 25px 30px;
  border-radius: 12px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  width: 90%;
  max-width: 500px; /* ポップアップの最大幅 */
  text-align: left;
  transform: scale(0.9);
  transition: transform 0.3s ease;
 }

 /* モーダル表示時のアニメーション */
 .modal-overlay.visible {
  opacity: 1;
 }
 .modal-overlay.visible .modal-content {
  transform: scale(1);
 }

 /* モーダル内のタイトル */
 #modal-title {
  font-size: 1.4em;
  font-weight: 700;
  color: #470d1c;
  margin-top: 0;
  margin-bottom: 15px;
  border-bottom: 2px solid #f0f0f0;
  padding-bottom: 10px;
 }

 /* モーダル内の詳細本文 */
 #modal-body {
  font-size: 1em;
  color: #333;
  line-height: 1.7;
 }
 #modal-body strong {
  color: #a04040;
 }

 /* 閉じるボタン */
 .modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 2em;
  color: #aaa;
  cursor: pointer;
  transition: color 0.2s ease;
  line-height: 1;
 }
 .modal-close:hover {
  color: #333;
 }

 </style>
</head>
<body>
 <nav class="topbar">
  <a href="index.html"><div class="RubyTech"><img class="R" src="/rubytech.png" alt="Logo"></div></a>
  <div class="nav-links">
   <a href="howto.html"> 学び方</a>
   <a href="level.html"> レベル一覧</a>
   <a href="videos.html"> 動画</a>
  </div>
 </nav>

 <h1>レベル一覧</h1>

 <div style="margin-bottom: 30px;">
  <input type="text" id="searchInput" placeholder="レベル名や内容で検索..." 
         style="padding: 12px 20px; width: 80%; max-width: 500px; border-radius: 25px; border: 2px solid #470d1c; outline: none; font-size: 1em;">
</div>

 <div class="levels" id="levels">

  <div class="level-box" data-level-id="level1">
   <div class="level-title">Level 1　（Rubyとは）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level1.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    まずは、<strong>Rubyとは何かを学びましょう。</strong><br>
    ここでは、<strong>Rubyの基本的な文法や概念</strong>を紹介します。<br>
    さらに、今回の教材で使用するBlocklyの使い方も説明します。<br>
    さあ、プログラミングの世界へ一歩踏み出しましょう！
   </div>
  </div>

  <div class="level-box" data-level-id="level2">
   <div class="level-title">Level 2　（puts・数字）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div> </div>
       <span class="progress-text">0% 完了</span> </div>
     <div class="action-area">
       <a href="level2.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    Rubyの基本的な<strong>「puts」</strong>を学びます。まずは、数字です。<br>
    画面に数字を出力することが最初の一歩です。<br>
    これは<strong>ほかの言語でも基本的に最初に行うこと</strong>です。<br>
    例としては<strong>Pythonのprint()</strong>や<strong>JavaScriptのconsole.log()</strong>などがあります。<br>
    さあ、数字を出力してみましょう！
   </div>
  </div>

  <div class="level-box" data-level-id="level3">
   <div class="level-title">Level 3　（puts・文字列）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level3.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    次に文字列の出力です。<br>
    Level 2で行ったRubyの基本的な<strong>「puts」</strong>の<strong>数字出力を文字列出力に置き換え</strong>ます。<br>
    なので、基本的にはLevel 2とほとんど同じ流れになります。<br>
    <strong>Level 2で使った技術を生かしてLevel 3もクリアしよう。</strong><br>
    さあ、文字列を出力してみましょう！
   </div>
  </div>

  <div class="level-box" data-level-id="level4">
   <div class="level-title">Level 4　（puts・四則演算）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div> </div>
       <span class="progress-text">0% 完了</span> </div>
     <div class="action-area">
       <a href="level4.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    次は、数字の<strong>四則演算</strong>を学びます。<br>
    Level 2で学んだ<strong>「puts」</strong>を使って、<strong>足し算、引き算、掛け算、割り算</strong>を行います。<br>
    ここでは、<strong>Rubyでの四則演算の基本的な使い方</strong>を学びます。<br>
    さあ、四則演算を使ってみましょう！
   </div>
  </div>

  <div class="level-box" data-level-id="level5">
   <div class="level-title">Level 5　（変数）</div> <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level5.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    <strong>変数</strong>を学びます。<br>
    <code>set</code> ブロックを使って、好きな名前を付けた変数に値を代入し、それを出力してみましょう。
   </div>
  </div>

  <div class="level-box" data-level-id="level6">
   <div class="level-title">Level 6　（if / else 条件分岐）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level6.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    <strong>条件分岐（<code>if</code> と <code>else</code>）</strong>を学びます。<br>
    変数と <code>></code>（比較）ブロックを使い、条件によって出力内容を変えてみましょう。
   </div>
  </div>

  <div class="level-box" data-level-id="level7">
   <div class="level-title">Level 7　（リストと .each ループ）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level7.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    複数のデータをまとめる <strong><code>リスト</code>（配列）</strong>と、<strong><code>.each</code></strong> ブロックを使った繰り返し処理を学びます。<br>
    リストの中身をすべて出力してみましょう。
   </div>
  </div>

  <div class="level-box" data-level-id="level8">
   <div class="level-title">Level 8　（ループと条件分岐）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level8.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    <strong><code>.each</code></strong> ループと <strong><code>if</code></strong> ブロックを組み合わせます。<br>
    リストの中身を調べ、特定の条件に合うものだけを出力するプログラムを作ります。
   </div>
  </div>

  <div class="level-box" data-level-id="level9">
   <div class="level-title">Level 9　（ループと文字列の連結）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level9.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    <strong><code>.each</code></strong> ループの中で、<strong><code>+</code></strong> ブロックを使って文字列を連結します。<br>
    リストのすべての要素に「!」を付けて出力してみましょう。
   </div>
  </div>

  <div class="level-box" data-level-id="level10">
   <div class="level-title">Level 10　（自由にコーディング）</div>
   <div class="level-summary">
     <div class="progress-area">
       <div class="progress-container">
         <div class="progress-bar" style="width: 0%;"></div>
       </div>
       <span class="progress-text">0% 完了</span>
     </div>
     <div class="action-area">
       <a href="level10.html" class="btn btn-study">学習する</a>
       <span class="view-details-link">レッスンを見る</span>
     </div>
   </div>
   <div class="level-details">
    自分で自由にコードを書いてみましょう！<br>
    <strong>Level 1〜9で学んだことを活かして、</strong><br>
    自分だけのプログラムを作成してみてください。
   </div>
  </div>


  </div> <div id="details-modal" class="modal-overlay">
   <div class="modal-content">
     <span class="modal-close">&times;</span>
     <h2 id="modal-title"></h2>
     <div id="modal-body"></div>
   </div>
 </div>
 
 <script>
  // ページの読み込みが完了したら実行
  document.addEventListener('DOMContentLoaded', () => {
   
   // ▼▼▼ ここから進捗表示処理を追加 ▼▼▼

   /**
    * すべてのレベルカードの進捗表示を更新する関数
    */
   function updateAllProgressDisplays() {
     const levelBoxes = document.querySelectorAll('.level-box[data-level-id]');

     levelBoxes.forEach(box => {
       const levelId = box.dataset.levelId;
       const storageKey = 'progress_' + levelId;

       // ローカルストレージから進捗を取得
       const progressValue = localStorage.getItem(storageKey);
       
       // ★★★ 修正点 ★★★
       // '100' かどうかではなく、保存された数値(なければ 0) をそのまま使う
       const percentage = parseInt(progressValue || '0');
       // ★★★★★★★★★★

       // --- UIに反映 ---
       const progressBar = box.querySelector('.progress-bar');
       if (progressBar) {
         progressBar.style.width = percentage + '%';
       }
       const progressText = box.querySelector('.progress-text');
       if (progressText) {
         progressText.textContent = percentage + '% 完了';
       }
     });
   }

   // ページ読み込み時に進捗を更新
   updateAllProgressDisplays();
    
    // モーダル関連の要素を取得
    const modalOverlay = document.getElementById('details-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const modalCloseButton = modalOverlay.querySelector('.modal-close');

    // 「レッスンを見る」リンクをすべて取得
    const detailLinks = document.querySelectorAll('.view-details-link');

    // モーダルを開く関数
    function openModal(title, detailsHtml) {
      modalTitle.textContent = title; // タイトルを設定
      modalBody.innerHTML = detailsHtml; // 詳細HTMLを設定
      
      modalOverlay.style.display = 'flex'; // オーバーレイを表示
      document.body.classList.add('modal-open'); // bodyのスクロールを禁止
      
      // 少し遅らせて 'visible' クラスを追加し、CSSアニメーションを発火
      setTimeout(() => {
        modalOverlay.classList.add('visible');
      }, 10);
    }

    // モーダルを閉じる関数
    function closeModal() {
      modalOverlay.classList.remove('visible'); // アニメーション用クラスを削除
      document.body.classList.remove('modal-open'); // bodyのスクロール禁止を解除

      // アニメーションが終わるのを待ってから非表示にする
      setTimeout(() => {
        modalOverlay.style.display = 'none';
      }, 300); // CSSの transition 時間 (0.3s) に合わせる
    }

    // すべての「レッスンを見る」リンクにクリックイベントを追加
    detailLinks.forEach(link => {
      link.addEventListener('click', (event) => {
        // リンクの親要素 (level-box) を探す
        const levelBox = event.currentTarget.closest('.level-box');
        
        // 親要素からタイトルと詳細を取得
        const title = levelBox.querySelector('.level-title').textContent;
        const detailsHtml = levelBox.querySelector('.level-details').innerHTML;

        // モーダルを開く
        openModal(title, detailsHtml);
      });
    });

    // 閉じるボタンがクリックされたらモーダルを閉じる
    modalCloseButton.addEventListener('click', closeModal);

    // モーダルの背景（オーバーレイ）がクリックされたらモーダルを閉じる
    modalOverlay.addEventListener('click', (event) => {
      // クリックされたのが背景（オーバーレイ）自身か確認
      if (event.target === modalOverlay) {
        closeModal();
      }
    });

    // --- Fuse.jsによる検索機能 ---

// 1. 全カード要素を取得し、検索用データを作成
const levelBoxes = Array.from(document.querySelectorAll('.level-box'));
const searchData = levelBoxes.map(box => {
  return {
    element: box,
    // タイトルと、隠れている詳細テキストの両方を検索対象にする
    title: box.querySelector('.level-title').textContent,
    details: box.querySelector('.level-details').textContent
  };
});

// 2. Fuse.js の初期化
const fuse = new Fuse(searchData, {
  keys: ["title", "details"], // 検索対象のキー
  threshold: 0.3,             // 0に近いほど厳密、1に近いほど曖昧
});

// 3. 入力時の処理
const searchInput = document.getElementById('searchInput');

searchInput.addEventListener('input', () => {
  const query = searchInput.value.trim();

  if (query === "") {
    // 検索窓が空ならすべて表示
    levelBoxes.forEach(box => box.style.display = 'flex');
    return;
  }

  // 検索実行
  const results = fuse.search(query);
  const matchedElements = results.map(result => result.item.element);

  // 一致するものだけ表示
  levelBoxes.forEach(box => {
    if (matchedElements.includes(box)) {
      box.style.display = 'flex'; // 元がflexなのでblockではなくflexを指定
    } else {
      box.style.display = 'none';
    }
  });
});
  });
 </script>
 </body>
</html>